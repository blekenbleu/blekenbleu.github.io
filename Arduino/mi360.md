---
title: D1 UNO USB (serial) as HID game controller based on mi-360
---

#### Background
Wanted: D1 UNO as HID game controller.  
Unlike FTDI USB chips, CH340G on D1 UNO can *only* be serial.
* Traditional __serial<>HID__ workaround was vJoy - no longer supported
#### workaround for workaround
* Arduino IBUS sketch from vJoySerialFeeder running on ESP8266
* [mi-360](https://github.com/dancol90/mi-360) uses [ViGEm.NET](https://github.com/ViGEm/ViGEm.NET), which *is* supported.
    * [C#](https://en.wikipedia.org/wiki/C_Sharp_(programming_language)) interface code for Xiaomi Gamepad
* Ultimately, derive a dedicated serial<>ViGEm filter from mi-360,  
    simpler than [VJoySerialFeeder](VJoySerialFeeder).
    * mi-360 runs in the system tray AKA taskbar and ["Notification Area"](https://www.howtogeek.com/75510/beginner-how-to-customize-and-tweak-your-system-tray-icons-in-windows-7/).
    * less daunting than VJoySerialFeeder,  
      which uses obsolete and undocumented SharpDevelop 4.4
    * need to extract serial port and IBUS code from VJoySerialFeeder
    * SerialPort-attached ESP8266 will not need HidGuardian
    * replace _monitor in mi-360/Mi360Application.cs with SerialPort equivalent
    * replace MiGamepad in XInputManager.cs with ESP8266 equivalent
    * replace Xiaomi Gamepad in __MiGamepad.cs__ with ESP8266 IBUS equivalent

#### C# code
      `DeviceWorker()` runs in a `Thread()`
        * ViGEmClient becomes `_Target`
        * Xiaomi Gamepad becomes `_Device`
        * `_Report` structure is eventually sent to `_Target`
* in `DeviceWorker()`, get `hidReport` from `_Device`, then `data` from `hidReport`,  
  hack `data` contents into `_Report`, __finally__ `_Target.SendReport(_Report)`;
* ViGEm referenced in README.md, MiGamepad.cs, mi-360-setup.iss, XInputManager.cs
* HidGuardian referenced in README.md, HidGuardian.cs, mi360.csproj,
      Mi360Application.cs, mi-360-setup.iss, Drivers/

    * presumably need to understand [HIDLibrary](https://www.nuget.org/packages/HidLibrary/) [GitHub](https://github.com/mikeobrien/HidLibrary)
    * HID (, USB, Serial Port) [references](http://janaxelson.com/hidpage.htm)  
    * .NET [SerialPort Class](https://docs.microsoft.com/en-us/dotnet/api/system.io.ports.serialport)
    * stackoverflow [SerialPort HowTo](https://stackoverflow.com/questions/1243070/how-to-read-and-write-from-the-serial-port)
    * [Coad's SerialPort article](https://blogs.msmvps.com/coad/2005/03/23/serialport-rs-232-serial-com-port-in-c-net/)

* [Visual Studio 2017 Community](https://visualstudio.microsoft.com/vs/community/).
* [Fody](https://github.com/Fody/Fody) "Extensible tool for weaving .net assemblies"
   * [Merging .NET Assemblies with MSBuild](https://peteris.rocks/blog/merging-net-assemblies-with-msbuild/)
   * [ILMerge](https://www.nuget.org/packages/ilmerge) merges multiple .NET assemblies into a single target
   * [NuGet](https://www.nuget.org/) is the package manager for .NET
       * [HowTo](https://docs.microsoft.com/en-us/nuget/quickstart/install-and-use-a-package-in-visual-studio)
       * [NuGet.Core](https://www.nuget.org/packages/NuGet.Core/) is the framework assembly on which the rest of NuGet is built.
       * [Notificaton Popup](https://www.nuget.org/packages/Tulpep.NotificationWindow/) [video](https://www.youtube.com/watch?v=CQowDMoTdNg)
       * [NativeUsbLib](https://github.com/DerekGn/NativeUsbLib) to enumerate Usb hubs and devices on Windows,  
         presumably based on [USBView](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/usbview)  
          Includes EnumerageUsb app.   

[Automapper](http://docs.automapper.org/en/stable/index.html) maps members among objects.  [vide0](https://www.youtube.com/watch?v=7xQm0EH8S0o)

