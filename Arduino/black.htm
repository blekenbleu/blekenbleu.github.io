<html lang="en-US">
  <head>
<link rel='stylesheet' type='text/css' href='../../static/my.css'>
<title>blekenbleu | Arduino for Black Pill</title>
</head>

  <body>
    <div id="container">
      <div class="inner" align=center>
<table class="my_table"><tr><td width=860>

<a href=index.html><font size=-1><i>back</i></font></a>
	
        <section id="main_content">
          <p><em>updated 19 Aug 2025</em></p>

<h3 id="arduino-for-black-pill">Arduino for Black Pill</h3>

<h4 id="background">Background</h4>
<p>Arduino originally employed microcontrollers lacking USB support.<br />
Newer Arduino have embedded USB and additional function via <a href=../../static/ArduinoUSB/index.htm>Pluggable USB API</a>,<br />
and ST Microelectronics now supports Arduino for many STM32 chips and boards.</p>
<ul>
  <li>Black and <a href="index">Blue Pill</a> modules use the same Arduino board manager.</li>
  <li>Arduino wants <code>STM32CubeProgrammer</code> for Black Pill DFU;&nbsp; (<i>installed in</i> <code>D:\my</code>)
    <ul>
      <li>added to path</li>
      <li><details>
	<a name=STM32CubeProgrammer>
	<summary></a>DFU failed in Arduino 2</summary><pre>Selected interface: dfu
      -------------------------------------------------------------------
                       STM32CubeProgrammer v2.6.0                  
      -------------------------------------------------------------------

Warning: Wrong connect parameter:</pre>
<b>This was <a href=https://arduino.stackexchange.com/questions/93017/stm32-black-pill-wont-enter-dfu-mode-reliably>floating A10</a> issue</b>;<br>
soldering pins later to the board and jumpering A10 to ground<br> &emsp; enabled DFU by BOOT + RST buttons.

<p>Trying something slightly different:<pre>C:\Users\bleke>STM32_Programmer_CLI -l
      -------------------------------------------------------------------
                       STM32CubeProgrammer v2.6.0
      -------------------------------------------------------------------

=====  DFU Interface   =====

No STM32 device in DFU mode connected

===== STLink Interface =====
Error: No ST-Link detected!</pre>
.. despite <code>UDBDeview</code> reporting:
<pre>Port_#0002.Hub_#0015 STM32 BOOTLOADER 100 mA USB\VID_0483&PID_DF11\3785389D3030 Removable, UniqueID</pre>

Installing STM32CubeProgrammer v2.20.0 did not discover the Black Pill;
<br>it does see my ST-Link V2 clone:<pre>===== STLink Interface =====

-------- Connected ST-LINK Probes List --------

ST-Link Probe 0 :
   ST-LINK SN  : 49FF72067566515033531081
   ST-LINK FW  : V2J37S7
   Access Port Number  : 0
   Board Name  :
-----------------------------------------------</pre></details>
.. so soldered pins to the Black Pill for SWD connection and DFU jumper.
<li>Dupont Wire color coding at ST-Link:<ul compact>
<li>GND (6) Black 
<li>SWDIO (4) Gray
<li>SWCLK (2) White
    </ul>
    </ul>
  </li>

<p>Black Pill pinout:<br>
<img src="https://scruss.com/wordpress/wp-content/uploads/2020/07/STM32F4x1_PinoutDiagram_RichardBalint-768x580.png" alt="WeAct STM32F4x1 board pinout"></p>
  <li>5V tolerant PWM pins are wanted for driving hobby servos
	or <a href="SimHubfans">4-wire PC fans</a>.</li>
  <li>Unlike Blue Pills, nearly all F401 Black Pill pins are 5V tolerant,<br> but not <code>PA0</code> and <code>PB5</code> on STM32F411.</li>
  <li><a href="https://hackaday.com/2021/01/20/blue-pill-vs-black-pill-transitioning-from-stm32f103-to-stm32f411/">Other Black (STM32F411) vs Blue (STM32F103) differences</a></li>
  <li><a href="https://stm32-base.org/boards/STM32F411CEU6-WeAct-Black-Pill-V2.0.html">Black Pill <code>KEY</code> button pulls PA0 LOW</a></li>
  <li>USB-C takes more pins; 14 remaining 5V-tolerant PWM pins:
<pre>PA15,PB3  PB6-9    PB0,1    PB 10  PA6,7    PA1-3
T2 CH1,2  T4 CH1-4 T3 CH3,4 T2 CH3 T3 CH1,2 T5 CH2-4</pre>
</ul>

<p><code>T2</code> and <code>T5</code> are 32-bit;  <code>T3</code> and <code>T4</code> are 16-bit;  <code>T1</code> is <a href="https://stm32f4-discovery.net/2014/05/stm32f4-stm32f429-discovery-pwm-tutorial">advanced 16-bit</a></p>

<p>Two more complementary PWM: PB13,15: T1 CH 1,3</p>

<p>There are at least 4 ways to flash STM32 chips:<ol>
<li> DFU (device firmware update) using DfuSe utility or STM32_Programmer_CLI,<br />
    using the <a href="https://www.st.com/en/development-tools/stsw-stm32080.html">STM32 system memory bootloader in ROM</a>,<br />
    using the <a href="https://www.sgbotic.com/index.php?dispatch=pages.view&amp;page_id=49">Black Pillâ€™s DFU bootloader with Arduino</a><br />
    By default, must force Black Pill into DFU using buttons on board..?<br>
	Reportedly,
    <a href="https://arduino.github.io/arduino-cli/latest/platform-specification">Arduino <code>use_1200bps_touch</code></a> jumps STM32 to
	<a href="https://github.com/arduino/tooling-rfcs/pull/2#issuecomment-825908911">STM32 ROM DFU bootloader</a>.<br />
    <a href="https://github.com/stm32duino/Arduino_Core_STM32/pull/710">STM32duino Beta enhancement</a>,
    <a href="https://github.com/arduino/arduino-cli/issues/1083">seemingly already supported for Arduino STM32 modules</a><br />
    <a href="https://stackoverflow.com/questions/26891432/jump-to-bootloader-in-stm32-through-application-i-e-using-boot-0-and-boot-1-pins#26958578">
			May require a resistor and capacitor</a>
<br><a href=https://www.youtube.com/watch?v=b1123kz_3MM>Caleb Marting's Black Pill DFU video</a>
<li> SWD via ST-LINK<br />
   ST-LINK SWD can be used for any STM32 chip.
<li> (Arduino) USB bootloader[s] &lt;- at least one <a href=https://github.com/Serasidis/STM32_HID_Bootloader>Arduino Black Pill bootloader</a> exists.
<br><a href=https://mischianti.org/stm32-programming-stm32f1-stm32f4-via-usb-with-hid-boot-loader-3/>discussion</a><br />
   <a href="https://hardwareliberopinerolo.github.io/site/blackpill/">WeAct HID bootloader on Black Pill</a><br />
<li> STM serial bootloader
	<a href="https://www.etechpath.com/how-to-flash-usb-bootloader-in-stm32-black-pill-board-to-program-it-with-arduino-ide/">
	for use with Arduino</a></ol>

<p>A clone ST-LINK V2 costs no more than a USB COM dongle,<br />
connects to dedicated pins and supports debug.</p>

My clone ST-Link happens to have the <em>correct pinout</em> printed on its cover;<br />
<b>Verify ST-LINK clone pin artwork</b> by sliding that cover partly open (along the USB plug):<br>
 &emsp; <img src="ST-Link.jpg" alt="ST-LINK pin artwork" /></p>

<h3 id="stm32duino">STM32duino</h3>
<p>Arduino now has an ST Microelectronics-supported
	<a href="https://github.com/stm32duino/Arduino_Core_STM32/releases">core and board manager</a><br />
<p><a href=../../static/Arduino2>Arduino 2 supports debugging</a>, but does not run correctly with <a href=../../static/RAMdisk/index.htm>ImDisk installed</a>.
<br>Alternatively, try <a href=../../static/VSCodeArduino/index.htm><b>VSCode-Arduino</b></a>
<p><a href="https://www.arduino.cc/en/software">Here is the Arduino software page</a>.<br />
<a href="https://www.stm32duino.com">Here is the <b>Arduino for STM32</b> forum</a>.
It replaced an earlier one, mostly for Maple/Roger Clark libraries.<br />
<a href="https://stm32duinoforum.com/forum/index_php.html">Here is the READ-ONLY version of that earlier Arduino for STM32 forum</a>.</p>

<h3><a href="https://www.st.com/resource/en/reference_manual/dm00119316-stm32f411xc-e-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf">
	STM32F411xC/E Reference manual</a></h3>

<h3 id="st-link-and-black-pill">ST-LINK and Black Pill</h3>
<p>Wiring Black Pill to ST-LINK V2 clone:
<img width=840 src="https://jorgegarciadev.gitlab.io/images/bmp.jpg" alt="wiring Black Pill to ST-LINK V2 clone" /><br />
Connect 3.3V from ST-LINK to Black Pill <b>only when Black Pill has no other connections</b><br />
Put another way, when using ST-LINK to debug Black Pill e.g. plugged to USB,<br />
  <b>do NOT connect 3.3V to Black Pill from ST-LINK</b>.</p>

<h3 id="installing-stm32duino-support">Installing STM32duino support</h3>
<p>SimHub bundles an <em>older version</em> of Arduino;&nbsp;
install a <a href=https://docs.arduino.cc/software/ide-v1/tutorials/PortableIDE/><b>portable</b></a> (ZIP file) Arduino for STM32;<br />
 &emsp; no need to install Arduino-specific driver[s]...<br>
1) Download, unzip, and run <a href="https://www.arduino.cc/en/software">Arduino</a><br />
&emsp; in my case, to <code>E:\my\Arduino\</code><br />
&emsp; <em>much of the following is thanks to <a href="https://www.sgbotic.com/index.php?dispatch=pages.view&amp;page_id=48">sgbotic</a></em>
<br>2) Go to <b><code>File</code> &gt; <code>Preferences</code></b>;&nbsp; add to <b><code>Additional Board Manager URLs</code></b> text box:
   <a href="https://github.com/stm32duino/BoardManagerFiles/raw/main/package_stmicroelectronics_index.json">
	https://github.com/stm32duino/BoardManagerFiles/raw/main/package_stmicroelectronics_index.json</a><br />
3) Go to <b><code>Tools</code> &gt; <code>Board</code> &gt; <code>Boards Manager</code></b>;&nbsp; enter search for <b><code>STM32</code></b>:<br />
   <img src="https://www.sgbotic.com/images/companies/1/learn/F103_Arduino/board_manager_install.png?1596271243306" alt="Boards Manager STM32 search" /><br />
&emsp;  click <b><code>STM32 Cores</code></b>, then <b><code>Install</code></b>  (<em>takes quite awhile</em>)<br />
4) Quit and restart Arduino; then<br />
&emsp; from <b><code>Tools &gt; Board: &gt; STM32 Boards</code></b>, select [<code>Generic STM32F4 series</code>].<br />
&emsp; From <b><code>Tools &gt; Board Part Number:</code></b>, select [<code>BlackPill F411CE</code>].<br />
&emsp; From <b><code>Tools &gt; Upload method:</code></b>, select [<code>STM32CubeProgrammer (DFU)</code>].</p>

<p>A simple next step uploads an Arduino blink loop sketch.</p>

<h3>Black Pill pin soldering</h3>
I use a <a href=https://www.amazon.com/dp/B000AS28UC>40W Weller WLC100</a> with a fine point, which works well,
<br> &emsp; except on ground pins, for which solder does not flow into thru holes,
<br> &emsp; presumably being cooled too much by the board's ground plane.
<br>To make solid ground solder joints, pull heated pins partially out, drawing solder into thru holes. 

<p><a href="SimHubCustomSerial">SimHub Custom serial hacking is described here</a>.</p>

        </section>
</td></tr><tr><td align=center>
maintained by <a href="https://github.com/blekenbleu">blekenbleu</a><br>
</td></tr></table>
      </div>
    </div>
  </body>
</html>
