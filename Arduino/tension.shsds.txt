{
  "AutomaticReconnect": true,
  "SerialPortName": "COM5",
  "IsConnecting": false,
  "IsEnabled": false,
  "LogIncomingData": true,
  "IsConnected": false,
  "BaudRate": 115200,
  "UpdateMessages": [
    {
      "Message": {
        "Expression": "format([OrientationYaw],0)+'\\t'+format([SpeedMph],0)+'\\t'+format([GlobalAccelerationG],0)+'\\r\\n'\r\n"
      },
      "IsEnabled": false,
      "MaximumFrequency": 0
    },
    {
      "Message": {
        "Interpreter": 1,
        "Expression": "var s = $prop('SpeedMph');\r\nvar y = $prop('OrientationYaw')\r\nreturn s\r\n"
      },
      "IsEnabled": false,
      "MaximumFrequency": 0
    },
    {
      "Message": {
        "Interpreter": 1,
        "Expression": "var l = [$prop('Settings.LeftOffset')];\r\nvar r = [$prop('Settings.RightOffset')];\r\nconst zero = [0];\r\nconst one = [1];\r\nconst os = String.fromCharCode(one);\r\nconst zs = String.fromCharCode(zero);\r\nvar ls = String.fromCharCode.apply(String, l);\r\nvar rs = String.fromCharCode.apply(String, r);\r\nreturn zs.concat(ls,os,rs);"
      },
      "IsEnabled": true,
      "MaximumFrequency": 0
    },
    {
      "Message": {
        "Expression": "'compute this'"
      },
      "IsEnabled": false,
      "MaximumFrequency": 5
    },
    {
      "Message": {
        "Interpreter": 1,
        "Expression": "// Initialize history\r\nif(root[\"speed\"]==null){\r\n   root[\"speed\"] = $prop('SpeedMph');\r\n   root[\"delta_s\"] = 0;\r\n}\r\nif(root[\"yaw\"]==null){\r\n   root[\"yaw\"] = $prop('OrientationYaw');\r\n   root[\"delta_y\"] = 0;\r\n}\r\nvar s = $prop('SpeedMph');\r\nvar y = $prop('OrientationYaw');\r\nvar ds = s - root[\"speed\"];\r\nvar dy = y - root[\"yaw\"];\r\n\r\nif (ds > 0)     // we are only interested in deceleration\r\n     ds = 0;\r\nelse ds = - ds; // positive deceleration\r\nif (dy > 180) {  // yaw went +/- 180\r\n  if (root[\"yaw\"] > 150 || root[\"yaw\"] < -150)\r\n    dy = y + root[\"yaw\"];\r\n}\r\n\r\nvar Gy = Math.round($prop('Settings.yaw_gain')) * dy;\r\nvar Gs = Math.round($prop('Settings.decel_gain')) * ds;\r\nif (Math.abs(dy) > 2 && Math.abs(dy) > Math.abs(1.8 * root[\"delta_y\"]))\r\n  Gy /= 2;      // remove sampling artifacts\r\nif (ds > 2 && ds > 1.8 * root[\"delta_s\"])\r\n  Gs /= 2;      // remove sampling artifacts\r\n\r\n// store values for next increment\r\nroot[\"speed\"] = s;\r\nroot[\"yaw\"] = y;\r\nroot[\"delta_y\"] = dy;\r\nroot[\"delta_s\"] = ds;\r\n\r\n// convert from braking and delta yaw to left and right tension\r\nvar l = Gs - Gy;\r\nvar r = Gs + Gy;\r\nif (l > 126)\r\n  l = 126;\r\nelse if (l < 2)\r\n  l = 2;\r\nl &= 0x7E;      // left is even\r\nif (r > 127)\r\n  r = 127;\r\nelse if (r < 3)\r\n  r = 3;\r\nr |= 1;         // right is odd.\r\n\r\n// var ls = String.fromCharCode.apply(l);\r\n// var rs = String.fromCharCode.apply(r);\r\nvar ls = Gs.toString();\r\nvar rs = Gy.toString();\r\nreturn ls.concat(' ', rs);\r\n"
      },
      "IsEnabled": true,
      "MaximumFrequency": 5
    }
  ],
  "OnConnectMessage": {
    "Expression": "' !'"
  },
  "OnDisconnectMessage": {
    "Expression": "' !'"
  },
  "DtrEnable": true,
  "RtsEnable": true,
  "EditorExpanded": true,
  "Name": "Custom Serial device",
  "Description": "Blue Pill belt servos",
  "LastErrorDate": "2021-02-02T13:04:54.8864886-05:00",
  "LastErrorMessage": null,
  "IsFreezed": false,
  "SettingsBuilder": {
    "Settings": [
      {
        "Maximum": 65,
        "Minimum": 0,
        "PropertyName": "LeftOffset",
        "CurrentValue": 64,
        "Name": null,
        "TypeName": "SliderEntry",
        "IsEnabled": true,
        "IsEnabledFormula": {
          "Expression": "[Settings.LeftOffset]"
        },
        "IsVisible": true,
        "Label": "Left tension",
        "IsVisibleFormula": {
          "Expression": ""
        }
      },
      {
        "Maximum": 65,
        "Minimum": 0,
        "PropertyName": "RightOffset",
        "CurrentValue": 60,
        "Name": null,
        "TypeName": "SliderEntry",
        "IsEnabled": true,
        "IsEnabledFormula": {
          "Expression": "[Settings.RightOffset]"
        },
        "IsVisible": true,
        "Label": "Right tension",
        "IsVisibleFormula": {
          "Expression": ""
        }
      },
      {
        "PropertyName": "TestOffsets",
        "CurrentValue": false,
        "Name": null,
        "TypeName": "BoolEntry",
        "IsEnabled": true,
        "IsEnabledFormula": {
          "Expression": ""
        },
        "IsVisible": true,
        "Label": "Test tension",
        "IsVisibleFormula": {
          "Expression": ""
        }
      },
      {
        "Maximum": 200,
        "Minimum": 0,
        "PropertyName": "decel_gain",
        "CurrentValue": 0,
        "Name": null,
        "TypeName": "SliderEntry",
        "IsEnabled": false,
        "IsEnabledFormula": {
          "Expression": "[Settings.decel_gain]"
        },
        "IsVisible": true,
        "Label": "decel gain",
        "IsVisibleFormula": {
          "Expression": ""
        }
      },
      {
        "Maximum": 200,
        "Minimum": 0,
        "PropertyName": "yaw_gain",
        "CurrentValue": 0,
        "Name": null,
        "TypeName": "SliderEntry",
        "IsEnabled": false,
        "IsEnabledFormula": {
          "Expression": "[Settings.yaw_gain]"
        },
        "IsVisible": true,
        "Label": "yaw gain",
        "IsVisibleFormula": {
          "Expression": ""
        }
      }
    ],
    "IsEditMode": false
  }
}