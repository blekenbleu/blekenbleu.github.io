<html>
<head>
<title>SimHub Discord plugin discussion</title>
</head>
<body>
<pre>Wotever 12/28/2017
To share a plugin, you must first rename it into the project settings,
and also rename the plugin class name
after you will just have to give the plugin dll
and enable it into the settings.
Plugins are the ultimate extensibility point :D, everything in simhub is based on it.
PluginDemo.cs
https://discord.com/channels/299259397060689920/306850703299575809/396037829886738432

7.4.17b1 - SDK now demonstrate how to use AttachDelegate instead of AddProperty/SetPropertyValue

Wotever 10/16/2021 8:47 AM
Attach property is a third property declaration way :D, there are three ways :
- SetPropertyValue : The simplest but the slowest, set the value at each update loop
- Attachproperty : it allows to add a "wrapper" for a property,
  which can be set at each game loop (it was an convoluted variation of the previous one,
  skipping SetPropertyValue costs, but keeping the disavantages of requiring computations for each loop.
  I keep this one in use internally for stuffs I need to compute for each loop anyway
  (about 40 properties in grand total I would say)
- AttachDelegate : zero costs if it's not in use

Attachproperty looks like:
public AttachedProperty<int> RGBIntensity = new AttachedProperty<int>();
public void Init(PluginManager pluginManager)
{
    RGBIntensity.Value = initialvalue;
    pluginManager.AttachProperty("RGBIntensity", typeof(SerialDashPlugin), properties.RGBIntensity);
}

void anotherfunc(){
      // This update has no particular CPU costs except computing "newvalue"
       RGBIntensity.Value = newvalue;
}

AttachProperty requires computing a result at each loop;
AttachDelegate is 100% on demand:
// Declare a property available in the property list,
// this gets evaluated "on demand" (when shown or used in formulas)
// '=>' is C# syntax for lambda experssion, in this case without input parameters
// https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/lambda-operator
this.AttachDelegate("CurrentDateTime", () => DateTime.Now);


GarySwallow 09/16/2019 3:38 PM
Advanced Custom Plugin Demo</pre>
Open the <a href="https://cdn.discordapp.com/attachments/306850703299575809/623241262493073410/AdvancedCustom.PluginSdkDemo.zip">AdvancedCustomUser.PluginSdkDemo.sln project file</a>.<br>
<br>
<a name=HowTo><h3>SimHub SDK How-To</h3></a>
SimHub SDK is in C#;&nbsp  <a href="https://www.w3schools.com/cs/">W3 C# Tutorial</a> describes C# elements well;<br>
content until C# Methods is classic C.<br>
<a href="https://www.tutorialspoint.com/csharp/">tutorialspoint Basic Syntax</a> page lists C# Keywords;<br>
Program Structures page introduces Visual Studio<br>
Sadly, employs concepts out of order or simply unexplained.<br>
<br>
Using SDK requires login to <a href="https://learn.microsoft.com/en-us/shows/intro-to-visual-studio/?wt.mc_id=educationalvside-c9-niner">Visual Studio</a>
using Microsoft account<br>
<a href="https://learn.microsoft.com/en-us/visualstudio/get-started/csharp/visual-studio-ide?view=vs-2019">Getting started</a><br>
<br>
<a href="https://learn.microsoft.com/en-us/visualstudio/get-started/csharp/?view=vs-2022">Getting started VS 2022</a><br>
<br>
Visual Studio 2019 does not update to 2022;&nbsp  VS 2022 installs in parallel.<br>
<a href="https://learn.microsoft.com/en-us/visualstudio/install/install-visual-studio?view=vs-2022">VS 2022 Installation instructions</a><br>
<br>
I clicked on a .csproj file, which launched Visual Studio<br>
<li> should really click on .sln file, but perhaps not important..?<br>
 &nbsp &nbsp .csproj file was listed in lower right Properties window<br>
<li> clicked on wrench icon, launching an Application window,<br>
 &nbsp &nbsp which showed .NET framework 4.7.2<br>
 &nbsp &nbsp <b>-</b> SimHub wants at least 4.8, per Wotever 8.2.0 release 12/16/2022<br>
 &nbsp &nbsp &nbsp Change framework setting in Visual Studio<br>
<br>
"When you create properties they are available inside the Properties list.<br>
 Then to access them you need to create the xaml page in Visual Studio<br>
 for your plugin" - <a href="https://discord.com/channels/299259397060689920/306850703299575809/1038925004965941269">Discord</a><br>
<img width=640 src="https://media.discordapp.net/attachments/306850703299575809/1038925004865273927/image.png"><br clear=all>
<dl>
<dt><br>SimHub plugins can add so-called <i>properties</i> which can be read in other plugins e.g. ShakeIt.<br>
<dd>Similarly, plugins can read properties that are e.g. set in ShakeIt plugin.<br>
e.g. (<a href="https://github.com/andreasdahl1987/DahlDesignProperties">Dahl Design Properties</a>
<a href="https://dahl-design.gitbook.io/properties/introduction/install#additional-setup">reads and sets properties</a> in
<a href="https://github.com/andreasdahl1987/DahlDesignProperties/blob/6c61e69e93ac3ddd97e9ba49972797ab8ddc66d2/iRacing/iRacing.cs#L1220">iRacing.cs</a>).
<pre>
...
namespace DahlDesign.Plugin.iRacing
{
  public class Data : SectionBase
  {
    public override void Init(PluginManager pluginManager)
    {
...
      InitializeLists();

      #region SimHub Properties
...
      Base.AddProp("SlipLF", 0);
      Base.AddProp("SlipRF", 0);
      Base.AddProp("SlipLR", 0);
      Base.AddProp("SlipRR", 0);
...
      #endregion
    }

    public override void DataUpdate()
    {
...
      double slipLF = Convert.ToDouble(Base.GetProp("ShakeITMotorsV3Plugin.Export.WheelSlip.FrontLeft"));  //Wheel slip
      double slipRF = Convert.ToDouble(Base.GetProp("ShakeITMotorsV3Plugin.Export.WheelSlip.FrontRight"));  //Wheel slip
      double slipLR = Convert.ToDouble(Base.GetProp("ShakeITMotorsV3Plugin.Export.WheelSlip.RearLeft"));  //Wheel slip
      double slipRR = Convert.ToDouble(Base.GetProp("ShakeITMotorsV3Plugin.Export.WheelSlip.RearRight"));  //Wheel slip
...

      Base.SetProp("SlipLF", slipLF);
      Base.SetProp("SlipRF", slipRF);
      Base.SetProp("SlipLR", slipLR);
      Base.SetProp("SlipRR", slipRR);
    }
  }
}
</pre>
At least in theory, by appropriately glueing something like this to MIDI code,<br>
MIDI sliders can be used to set SimHub property values,
while SimHub property values can be used to set MIDI values for e.g. VST level trimmers

<dt><br>C# plugin source and discussions
<dd>Here is <a href="PluginDemo.cs">an older and smaller PluginDemo.cs</a>.
</dl>
<hr>
<a name=ChatGPT><h3>OpenAI ChatGPT code for SImHub plugin using DryWetMIDI</h3></a>
<pre>
// Here is an example of how you might use the DryWetMIDI library
// in a SimHub plugin to send MIDI messages:

using SimHub;
using DryWetMIDI.Devices;
using DryWetMIDI.Interaction;

namespace MySimHubPlugin
{
    public class MySimHubPlugin : Plugin
    {
        private OutputDevice _midiOut;

        public override void Start()
        {
            // Connect to the first available MIDI output device
            _midiOut = OutputDevice.GetByName("My MIDI Device");
        }

        public override void Update()
        {
            // Send a MIDI message to turn on a note
            _midiOut.Send(new NoteOn(Channel.Channel1, 60, 100));
        }
    }
}
/* This plugin connects to the first MIDI output device that is available
 ; and sends a MIDI "note on" message to it on each frame.
 ; The message will turn on a note with a pitch of 60 (middle C)
 ; and a velocity of 100 on channel 1.
 */
</pre>
</body>
</html>
